{"_path":"/frontend-code-assessment/scene/image-format-conversion","_dir":"scene","_draft":false,"_partial":false,"_locale":"","title":"图片格式转换","description":"","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"转换为-webp"},"children":[{"type":"text","value":"转换为 webp"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"阿里云 oss 支持通过链接后面拼接参数来做图片的格式转换，尝试实现把任意图片格式转换为 webp 格式"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"需要注意 webp 兼容性"}]}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes slack-ochin slack-ochin ayu-dark","code":"function checkWebp() {\n  try {\n    const canvas = document.createElement(\"canvas\");\n    return canvas.toDataURL(\"image/webp\").indexOf(\"data:image/webp\") === 0;\n  } catch (err) {\n    return false;\n  }\n}\n\nfunction webpImageUrl(url) {\n  if (!url) {\n    throw new Error(\"url not null\");\n  }\n  // base64\n  if (url.startsWith(\"data:\")) {\n    return url;\n  }\n  const supportWebp = checkWebp();\n  if (!supportWebp) {\n    return url;\n  }\n  return `${url}?x-oss-processxxx`;\n}\n","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#0991B6;--shiki-default:#0991B6;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7EB233;--shiki-default:#7EB233;--shiki-dark:#FFB454"},"children":[{"type":"text","value":" checkWebp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"  try"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#0991B6;--shiki-default:#0991B6;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"    const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#2F86D2;--shiki-default:#2F86D2;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":" canvas"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#F29668"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#2F86D2;--shiki-default:#2F86D2;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":" document"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#F29668"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7EB233;--shiki-default:#7EB233;--shiki-dark:#FFB454"},"children":[{"type":"text","value":"createElement"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#A44185;--shiki-default:#A44185;--shiki-dark:#AAD94C"},"children":[{"type":"text","value":"\"canvas\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6B3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#2F86D2;--shiki-default:#2F86D2;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":" canvas"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#F29668"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7EB233;--shiki-default:#7EB233;--shiki-dark:#FFB454"},"children":[{"type":"text","value":"toDataURL"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#A44185;--shiki-default:#A44185;--shiki-dark:#AAD94C"},"children":[{"type":"text","value":"\"image/webp\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#F29668"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7EB233;--shiki-default:#7EB233;--shiki-dark:#FFB454"},"children":[{"type":"text","value":"indexOf"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#A44185;--shiki-default:#A44185;--shiki-dark:#AAD94C"},"children":[{"type":"text","value":"\"data:image/webp\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#F29668"},"children":[{"type":"text","value":"==="}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#174781;--shiki-default:#174781;--shiki-dark:#D2A6FF"},"children":[{"type":"text","value":" 0"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6B3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"catch"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#2F86D2;--shiki-default:#2F86D2;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"err"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#174781;--shiki-default:#174781;--shiki-dark:#D2A6FF"},"children":[{"type":"text","value":" false"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6B3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#0991B6;--shiki-default:#0991B6;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7EB233;--shiki-default:#7EB233;--shiki-dark:#FFB454"},"children":[{"type":"text","value":" webpImageUrl"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#B1108E;--shiki-default:#B1108E;--shiki-dark:#D2A6FF"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#F29668"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#2F86D2;--shiki-default:#2F86D2;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"    throw"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#F29668"},"children":[{"type":"text","value":" new"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7EB233;--shiki-default:#7EB233;--shiki-dark:#FFB454"},"children":[{"type":"text","value":" Error"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#A44185;--shiki-default:#A44185;--shiki-dark:#AAD94C"},"children":[{"type":"text","value":"\"url not null\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6B3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#357B42;--shiki-default:#357B42;--shiki-dark:#ACB6BF8C;--shiki-light-font-style:italic;--shiki-default-font-style:italic;--shiki-dark-font-style:italic"},"children":[{"type":"text","value":"  // base64\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#2F86D2;--shiki-default:#2F86D2;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#F29668"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7EB233;--shiki-default:#7EB233;--shiki-dark:#FFB454"},"children":[{"type":"text","value":"startsWith"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#A44185;--shiki-default:#A44185;--shiki-dark:#AAD94C"},"children":[{"type":"text","value":"\"data:\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":")) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#2F86D2;--shiki-default:#2F86D2;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":" url"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6B3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#0991B6;--shiki-default:#0991B6;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"  const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#2F86D2;--shiki-default:#2F86D2;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":" supportWebp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#F29668"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7EB233;--shiki-default:#7EB233;--shiki-dark:#FFB454"},"children":[{"type":"text","value":" checkWebp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"()"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6B3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#F29668"},"children":[{"type":"text","value":"!"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#2F86D2;--shiki-default:#2F86D2;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"supportWebp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#2F86D2;--shiki-default:#2F86D2;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":" url"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6B3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#7B30D0;--shiki-default:#7B30D0;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"  return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#A44185;--shiki-default:#A44185;--shiki-dark:#AAD94C"},"children":[{"type":"text","value":" `"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#A44185;--shiki-default:#A44185;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"${"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#2F86D2;--shiki-default:#2F86D2;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"url"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#A44185;--shiki-default:#A44185;--shiki-dark:#FF8F40"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#A44185;--shiki-default:#A44185;--shiki-dark:#AAD94C"},"children":[{"type":"text","value":"?x-oss-processxxx`"}]},{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6B3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-light:#002339;--shiki-default:#002339;--shiki-dark:#BFBDB6"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html.light .shiki span {color: var(--shiki-light);background: var(--shiki-light-bg);font-style: var(--shiki-light-font-style);font-weight: var(--shiki-light-font-weight);text-decoration: var(--shiki-light-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}"}]}],"toc":{"title":"","searchDepth":5,"depth":5,"links":[{"id":"转换为-webp","depth":2,"text":"转换为 webp"}]}},"_type":"markdown","_id":"content:3.frontend-code-assessment:2.scene:Image-format-conversion.md","_source":"content","_file":"3.frontend-code-assessment/2.scene/Image-format-conversion.md","_extension":"md"}